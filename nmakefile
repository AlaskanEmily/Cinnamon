# Any copyright is dedicated to the Public Domain.
# http://creativecommons.org/publicdomain/zero/1.0/

OBJ=.obj

PATHSEP= \ 
MIXER_TYPE=win32

LINK=link
LINKFLAGS=/NOLOGO /DLL /OUT:cinnamon.dll /PDB:cinnamon.pdb
CL=cl
CLFLAGS=/nologo /GF /EHsc /arch:SSE /Zi /c /WX /DCIN_INTERNAL /I$(MAKEDIR)\include /I$(MAKEDIR) /I$(MAKEDIR)\mixer
CFLAGS=$(CLFLAGS) /O1 /W2
CXXFLAGS=$(CLFLAGS) /Os /W3

!INCLUDE cin_build.mk
!INCLUDE openal\cin_build_openal.mk
!INCLUDE dsound\cin_build_dsound.mk

# Common objects
cin_common.obj: $(CIN_COMMON_DEPS)
	$(CL) $(CFLAGS) cin_common.c

cin_loader_soft.obj: $(CIN_LOADER_SOFT_DEPS)
	$(CL) $(CFLAGS) cin_loader_soft.c

# Mixer objects 
cin_lock_win32.obj: mixer\win32\cin_lock_win32.c mixer\cin_lock.h
	$(CL) $(CXXFLAGS) mixer\win32\cin_lock_win32.c

cin_thread_win32.obj: mixer\win32\cin_thread_win32.c mixer\cin_thread.h
	$(CL) $(CXXFLAGS) mixer\win32\cin_thread_win32.c

# DirectSound objects
cin_driver_dsound.obj: $(CIN_DRIVER_DSOUND_DEPS)
	$(CL) $(CXXFLAGS) dsound\cin_driver_dsound.cpp

cin_sound_dsound.obj: $(CIN_SOUND_DSOUND_DEPS)
	$(CL) $(CXXFLAGS) dsound\cin_sound_dsound.cpp

# OpenAL objects
cin_loader_openal.obj: $(CIN_LOADER_OPENAL_DEPS)
	$(CL) $(CFLAGS) openal\cin_loader_openal.c

cin_driver_openal.obj: $(CIN_DRIVER_OPENAL_DEPS)
	$(CL) $(CFLAGS) openal\cin_driver_openal.c

cin_sound_openal.obj: $(CIN_SOUND_OPENAL_DEPS)
	$(CL) $(CFLAGS) openal\cin_sound_openal.c

#Test objects
sine_test.obj: $(SINE_TEST_DEPS)
	$(CL) $(CFLAGS) sine_test.c

cinnamon.dll: $(DSOUND_OBJECTS) cin_common.obj $(TEST_OBJS)
	$(LINK) $(DSOUND_OBJECTS) cin_common.obj dsound.lib dxguid.lib $(LINKFLAGS)
	$(LINK) sine_test.obj cinnamon.lib /NOLOGO

openal: $(OPENAL_OBJECTS) cin_common.obj $(TEST_OBJS)
	$(LINK) $(OPENAL_OBJECTS) cin_common.obj lib\OpenAL32.lib $(LINKFLAGS)
	$(LINK) sine_test.obj cinnamon.lib /NOLOGO

dsound: cinnamon.dll
